<script>
  // Ø±Ø§Ø¨Ø· Apps Script (ØªÙ… Ù†Ù‚Ù„Ù‡ Ù‡Ù†Ø§ Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ)
  const APP_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyxGeQ1UMreakJe3X6GzBwzBzpHzHmEqTllv__US14CoUIf2damdO7hQEyo6pvFS88v7A/exec";
</script>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>âœ¨ ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø±ÙˆØ¶Ùƒ Ø§Ù„Ø®Ø§ØµØ© Ø§Ù„Ø¢Ù†</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root {
      /* ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙØ®Ø§Ù…Ø© (Deep Blue) */
      --primary-color: #1a5276; 
      --success-color: #2ecc71;
      --error-color: #e74c3c;
      /* Ù„ÙˆÙ† Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© (Ø£Ø®Ø¶Ø± ÙØ§ØªØ­) */
      --warning-color: #27ae60; 
      /* ØªØºÙŠÙŠØ± Ø¨Ø³ÙŠØ· ÙÙŠ ØªØ¯Ø±Ø¬ Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ø¬Ø¹Ù„Ù‡Ø§ Ø£Ù†Ø¹Ù… */
      --background-gradient: linear-gradient(135deg, #ffffff, #eaf2f8); 
      --text-color: #34495e; /* Ù„ÙˆÙ† Ù†Øµ ØºØ§Ù…Ù‚ Ø¬Ø¯ÙŠØ¯ */
    }
    body {
      /* Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø· Tajawal Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
      font-family: 'Tajawal', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      background: var(--background-gradient);
      text-align: center;
      padding: 20px;
    }
    .container {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 25px rgba(0, 0, 0, 0.15); /* Ø¸Ù„ Ø£Ù‚ÙˆÙ‰ */
      /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù€ 600px Ù„Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø£ÙˆØ³Ø¹ */
      max-width: 90%;
      width: 600px; 
    }
    .logo-img {
        max-width: 120px; /* Ø­Ø¬Ù… Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø´Ø¹Ø§Ø± */
        height: auto;
        margin-bottom: 20px;
        display: block;
        margin-left: auto;
        margin-right: auto;
        border-radius: 8px; /* Ù„Ù…Ø³Ø© Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ø´Ø¹Ø§Ø± */
    }
    .loader {
      border: 6px solid #f3f3f3;
      border-top: 6px solid var(--primary-color);
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px auto;
      display: block;
    }
    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
    /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±Ù† ÙˆØ§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© */
    .message {
      font-size: 22px; 
      margin-bottom: 20px;
      color: var(--text-color);
      font-weight: 800; 
      display: block; /* ØªØºÙŠÙŠØ± Ù„ÙŠØªÙ… Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ */
      text-align: center;
    }
    .message i {
      margin-left: 10px;
      font-size: 26px; 
    }
    
    /* ØªØµÙ…ÙŠÙ… Ø¬Ø¯ÙŠØ¯ Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø§Ù„Ù…Ù†Ø¸Ù…Ø© */
    .countdown-message-layout {
      display: flex;
      flex-direction: column; /* ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹ */
      align-items: center;
      justify-content: center;
      font-size: 19px; /* ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ù„ØªØ­Ø³ÙŠÙ† */
      font-weight: 700;
      line-height: 1.5; /* Ø²ÙŠØ§Ø¯Ø© ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø£Ø³Ø·Ø± */
    }

    .countdown-message-layout .main-text {
      margin: 5px 0;
    }

    .countdown-message-layout i {
      font-size: 28px; /* Ø­Ø¬Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
      margin-bottom: 5px;
      margin-left: 0; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
    }
    
    .progress-bar-container {
      width: 100%;
      height: 12px;
      background: #ddd;
      border-radius: 6px;
      margin-bottom: 20px;
      overflow: hidden;
      display: none;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    .progress-bar {
      width: 0%;
      height: 100%;
      background: var(--success-color);
      border-radius: 6px;
      transition: width 0.1s linear;
    }
    #retryBtn {
      display: none;
      padding: 10px 25px;
      background: var(--warning-color); 
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 15px;
      transition: background 0.3s, transform 0.2s;
      font-weight: 700;
    }
    #retryBtn:hover {
      background: #2ecc71; 
      transform: translateY(-2px);
    }
    .offers-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
      width: 100%;
    }
    .offer-card {
      padding: 18px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ */
      background: var(--primary-color);
      color: #fff;
      border-radius: 10px; /* Ø¬Ø¹Ù„ Ø§Ù„Ø­ÙˆØ§Ù Ø£ÙƒØ«Ø± Ù†Ø¹ÙˆÙ…Ø© */
      cursor: pointer;
      font-size: 19px; /* Ø­Ø¬Ù… Ø®Ø· Ø£ÙƒØ¨Ø± */
      font-weight: 700;
      text-align: right;
      transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
      border-bottom: 5px solid #154360; /* ØªØ¯Ø±Ø¬ Ø£ØºÙ…Ù‚ Ù„Ù„Ø­Ø¯ */
      position: relative; 
      padding-right: 55px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
    }
    .offer-card:before {
        content: 'ğŸ’'; /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø§Ø³ÙŠØ© Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø¹Ø±Ø¶ */
        position: absolute;
        left: 15px;
        font-size: 28px;
        top: 50%;
        transform: translateY(-50%);
        opacity: 0.9;
    }
    .offer-card:hover {
      background: #1a5276;
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25); /* Ø¸Ù„ Ø£Ù‚ÙˆÙ‰ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙ… */
    }
    .offer-description {
      font-size: 15px; /* Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„ÙˆØµÙ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      font-weight: 500; /* Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ²Ù† Ù…ØªÙˆØ³Ø· */
      margin-top: 8px;
      opacity: 0.9;
    }
    .icon-sad:before { content: 'ğŸ™'; }
    .icon-warn:before { content: 'âš ï¸'; }
    .icon-success:before { content: 'âœ…'; }
    .icon-gift:before { content: 'ğŸ'; }
    .icon-choose:before { content: 'ğŸ‘†'; } 
    
    /* Media Query: ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù‡Ø§ØªÙ (Ø£Ù‚Ù„ Ù…Ù† 600 Ø¨ÙƒØ³Ù„) */
    @media (max-width: 600px) {
        .container {
            padding: 20px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„Ø­Ø§ÙˆÙŠØ© */
        }
        .countdown-message-layout {
            font-size: 17px; /* ØªØµØºÙŠØ± Ø®Ø· Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
        }
        .message {
            font-size: 19px; /* ØªØµØºÙŠØ± Ø®Ø· Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
        }
    }
  </style>
</head>
<body>

  <div class="container">
    <img src="images/photo.jpg" alt="Logo" class="logo-img">
    
    <div class="loader"></div>
    <div class="message">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ø±ÙˆØ¶<span id="dots">...</span></div>
    <div class="progress-bar-container">
      <div class="progress-bar"></div>
    </div>
    <div id="offersList" class="offers-list"></div>
    <button id="retryBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
  </div>

  <script>
    // **ØªÙ… Ø¥Ø²Ø§Ù„Ø© ØªØ¹Ø±ÙŠÙ APP_SCRIPT_URL Ù…Ù† Ù‡Ù†Ø§ Ù„Ø£Ù†Ù‡ ØªÙ… Ù†Ù‚Ù„Ù‡ Ø¥Ù„Ù‰ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ù„Ù**

    const loader = document.querySelector('.loader');
    const messageDiv = document.querySelector('.message');
    const progressBarContainer = document.querySelector('.progress-bar-container');
    const progressBar = document.querySelector('.progress-bar');
    const retryBtn = document.getElementById('retryBtn');
    const offersListDiv = document.getElementById('offersList');
    let dotsSpan = null; 

    let dotInterval = null;

    function startDotAnimation() {
      if (dotInterval) clearInterval(dotInterval);
      dotsSpan = document.getElementById('dots');
      let dotCount = 0;
      dotInterval = setInterval(() => {
        dotCount = (dotCount + 1) % 4;
        if(dotsSpan) dotsSpan.textContent = '.'.repeat(dotCount);
      }, 500);
    }

    function stopDotAnimation() {
        if (dotInterval) {
            clearInterval(dotInterval);
            dotInterval = null;
        }
    }

    async function checkOffer() {
      retryBtn.style.display = 'none';
      loader.style.display = 'block';
      progressBarContainer.style.display = 'none';
      messageDiv.style.color = 'var(--text-color)'; 
      messageDiv.innerHTML = 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ø±ÙˆØ¶<span id="dots">...</span>';
      offersListDiv.innerHTML = '';
      startDotAnimation();

      try {
        const response = await fetch(APP_SCRIPT_URL);
        const offers = await response.json();

        let activeOffers = offers.filter(o => (o.activ || "").toUpperCase() === "Y")
          .map(o => ({
            title: o.title,
            link: `Offer.html?title=${encodeURIComponent(o.title)}`,
            description: o.description || ''
          }));

        loader.style.display = 'none';
        stopDotAnimation();


        if(activeOffers.length === 0){
          // Ù…Ø­ØªÙˆÙ‰ ØªÙØ§Ø¹Ù„ÙŠ Ø¬Ø¯ÙŠØ¯
          messageDiv.innerHTML = '<i class="icon-sad"></i> Ù„Ù„Ø£Ø³ÙØŒ **Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹**. Ù†Ø¹Ø¯Ùƒ Ø¨Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹ØŒ ØªÙÙ‚Ø¯Ù†Ø§ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!';
          messageDiv.style.color = 'var(--error-color)';
        } else if(activeOffers.length === 1){
          // ** ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ **
          startCountdown(activeOffers[0].title, activeOffers[0].link);
        } else {
          // Ù…Ø­ØªÙˆÙ‰ ØªÙØ§Ø¹Ù„ÙŠ Ø¬Ø¯ÙŠØ¯
          messageDiv.innerHTML = '<i class="icon-choose"></i> **ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!** ØªÙˆØ¬Ø¯ **Ø¹Ø¯Ø© Ø¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ©** Ù„ÙƒØŒ Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø°ÙŠ ÙŠÙ†Ø§Ø³Ø¨Ùƒ Ø§Ù„Ø¢Ù†:';
          activeOffers.forEach(offer => {
            const card = document.createElement('div');
            card.className = 'offer-card';
            card.innerHTML = `
              <div>${offer.title}</div>
              ${offer.description ? `<div class="offer-description">${offer.description}</div>` : ''}
            `;
            card.onclick = () => window.location.href = offer.link;
            offersListDiv.appendChild(card);
          });
        }

      } catch(err) {
        console.error(err);
        loader.style.display = 'none';
        progressBarContainer.style.display = 'none';
        // Ù…Ø­ØªÙˆÙ‰ ØªÙØ§Ø¹Ù„ÙŠ Ø¬Ø¯ÙŠØ¯
        messageDiv.innerHTML = '<i class="icon-warn"></i> Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.'; 
        messageDiv.style.color = 'var(--warning-color)';
        retryBtn.style.display = 'inline-block';
        stopDotAnimation();
      }
    }

    // ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„ØªØ¨Ø¯Ø£ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙ…Ù‚Ø³Ù…Ø©
    function startCountdown(offerTitle, offerLink){
      let seconds = 5;
      progressBarContainer.style.display = 'block';
      progressBar.style.width = '0%';
      
      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø³Ù… Ù„ÙÙƒ Ø§Ù„Ø§Ø²Ø¯Ø­Ø§Ù…
      messageDiv.innerHTML = `
        <div class="countdown-message-layout">
          <i class="icon-success"></i>
          <span class="main-text">ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯! Ø¹Ø±Ø¶ "**${offerTitle}**" Ù‡Ùˆ ÙØ±ØµØªÙƒ Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©.</span>
          <span class="main-text">**Ø³ÙŠØªÙ… Ù†Ù‚Ù„Ùƒ Ø®Ù„Ø§Ù„ <span id="countdownSec">${seconds}</span> Ø«ÙˆØ§Ù†ÙŠ** Ù„Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù†Ù‡!</span>
        </div>
      `;
      messageDiv.style.color = 'var(--success-color)';

      const countdownSecSpan = document.getElementById('countdownSec');

      const interval = setInterval(() => {
        seconds--;
        progressBar.style.width = `${((5-seconds)/5)*100}%`;

        if(seconds > 0){
          countdownSecSpan.textContent = seconds;
        } else {
          clearInterval(interval);
          window.location.href = offerLink;
        }
      }, 1000);
    }

    retryBtn.onclick = checkOffer;
    checkOffer();
  </script>

</body>
</html>
